import{r as t,o,c as e,a as n,b as p,F as c,d as s,e as l}from"./app.545fb905.js";import{_ as r}from"./plugin-vue_export-helper.21dcd24c.js";const u={},i=n("h1",{id:"_2022\u5E7402\u670822\u65E5",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2022\u5E7402\u670822\u65E5","aria-hidden":"true"},"#"),s(" 2022\u5E7402\u670822\u65E5")],-1),k=n("h2",{id:"\u5934\u6761",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u5934\u6761","aria-hidden":"true"},"#"),s(" \u5934\u6761")],-1),b={href:"https://toutiao.io/k/vjw1dlc",target:"_blank",rel:"noopener noreferrer"},m=s("Golang \u7B80\u6D01\u67B6\u6784\u5B9E\u6218"),d={href:"https://toutiao.io/k/emhzf5r",target:"_blank",rel:"noopener noreferrer"},f=s("Golang\xA0\u8BED\u8A00 gRPC \u670D\u52A1\u600E\u4E48\u540C\u65F6\u652F\u6301 gRPC \u548C HTTP \u5BA2\u6237\u7AEF\u8C03\u7528\uFF1F"),_={href:"https://toutiao.io/k/pqacedc",target:"_blank",rel:"noopener noreferrer"},h=s("\u8FD8\u5728\u7528ES\u67E5\u65E5\u5FD7\u5417\uFF0C\u5FEB\u770B\u770B\u77F3\u58A8\u6587\u6863 Clickhouse \u65E5\u5FD7\u67B6\u6784\u73A9\u6CD5"),g={href:"https://toutiao.io/k/cqip8a8",target:"_blank",rel:"noopener noreferrer"},y=s("K8s \u4E3A\u4EC0\u4E48\u8FD9\u4E48\u590D\u6742\uFF1F"),w={href:"https://toutiao.io/k/lk15pdx",target:"_blank",rel:"noopener noreferrer"},x=s("\u643A\u7A0B\u7684\u6DF7\u5408\u529E\u516C\uFF0C\u5230\u5E95\u884C\u4E0D\u884C\uFF1F12\u4E2AVue\u5C0F\u6280\u5DE7\uFF1B2022\u5E74\u4E4BWeb\u5F00\u53D1\u65B0\u57FA\u51C6\uFF5C\u7801\u519C\u5468\u520AVIP\u4F1A\u5458\u4E13\u5C5E\u90AE\u4EF6\u5468\u62A5 Vol.080"),q={href:"https://toutiao.io/k/xsynx5j",target:"_blank",rel:"noopener noreferrer"},A=s("\u4E00\u6B3E\u5F00\u6E90NFT\u5E02\u573A"),v={href:"https://toutiao.io/k/7sdby3w",target:"_blank",rel:"noopener noreferrer"},P=s("\u4E0D\u5E9F\u8BDD\uFF0C\u4EE3\u7801\u5B9E\u8DF5\u5E26\u4F60\u638C\u63E1 \u5F3A\u7F13\u5B58\u3001\u534F\u5546\u7F13\u5B58\uFF01"),G={href:"https://toutiao.io/k/gwo840i",target:"_blank",rel:"noopener noreferrer"},I=s("\u7528 Peer.js \u6109\u5FEB\u4E0A\u624B P2P \u901A\u4FE1"),S={href:"https://toutiao.io/k/vpbar1l",target:"_blank",rel:"noopener noreferrer"},U=s("\u89C2\u70B9\uFF5CSparkSQL\u5728\u4F01\u4E1A\u7EA7\u6570\u4ED3\u5EFA\u8BBE\u7684\u4F18\u52BF"),W={href:"https://toutiao.io/k/keoawt5",target:"_blank",rel:"noopener noreferrer"},R=s("\u505A\u5230\u8FD97\u70B9\uFF0C\u907F\u514D\u5FAE\u670D\u52A1\u843D\u5730\u5931\u8D25"),N={href:"https://toutiao.io/k/09pwff0",target:"_blank",rel:"noopener noreferrer"},C=s("\u5DE5\u4F5C\u4E2D\u7684\u201C\u53A8\u5E08\u201D\uFF0C\u751F\u6D3B\u4E0A\u7684\u8BD7\u4EBA\uFF0C\u5176\u5B9E\u4E5F\u662F\u67B6\u6784\u5E08"),E={href:"https://toutiao.io/k/8o9533u",target:"_blank",rel:"noopener noreferrer"},T=s("\u5927\u5382\u504F\u7231\u7684Agent\u6280\u672F\u7A76\u7ADF\u662F\u4E2A\u5565"),H={href:"https://toutiao.io/k/7k375t4",target:"_blank",rel:"noopener noreferrer"},L=s("\u9AD8\u6548\u4F7F\u7528Chrome\u6D4F\u89C8\u5668\uFF0C\u4F60\u53EF\u80FD\u4E0D\u77E5\u9053\u768410\u4E2A\u6280\u5DE7\u3002"),V={href:"https://toutiao.io/k/do3l9kc",target:"_blank",rel:"noopener noreferrer"},D=s("\u5B66\u4E60\u65B9\u6CD5\uFF5C\u4E00\u628A\u89E3\u5F00Kafka\u80CC\u540E\u673A\u5236\u7684\u201C\u94A5\u5319\u201D"),F={href:"https://toutiao.io/k/n48ld2w",target:"_blank",rel:"noopener noreferrer"},j=s("\u5982\u4F55\u7528\u5EFA\u6728CI\u5F80\u4E03\u725B\u4E91\u4E0A\u4F20\u6587\u4EF6"),M={href:"https://toutiao.io/k/meof9d2",target:"_blank",rel:"noopener noreferrer"},$=s("Android Studio \u5BF9\u73B0\u4EE3 WorkManager \u7684\u652F\u6301"),z={href:"https://toutiao.io/k/riqcjql",target:"_blank",rel:"noopener noreferrer"},B=s("\u4F60\u7406\u60F3\u7684\u6DF7\u5408\u73B0\u5B9EMR\u4E16\u754C\u662F\u4EC0\u4E48\u6837\u7684\u5462"),K={href:"https://toutiao.io/k/nf1kyvz",target:"_blank",rel:"noopener noreferrer"},J=s("Hyperledger Fabric 2.x Java\u533A\u5757\u94FE\u5E94\u7528"),O={href:"https://toutiao.io/k/t1d9x3b",target:"_blank",rel:"noopener noreferrer"},Q=s("[\u63A8\u8350] \u5982\u4F55\u64B0\u5199\u597D\u6280\u672F\u65B9\u6848\u8BBE\u8BA1-\u771F\u5B9E\u6848\u4F8B\u5E72\u8D27\u5206\u4EAB"),X={href:"https://toutiao.io/k/upx1qip",target:"_blank",rel:"noopener noreferrer"},Y=s("[\u63A8\u8350] \u4E00\u5F20\u56FE\u770B\u61C2\u5FAE\u670D\u52A1\u67B6\u6784\u8DEF\u7EBF"),Z={href:"https://toutiao.io/k/o77uhyt",target:"_blank",rel:"noopener noreferrer"},nn=s("[\u63A8\u8350] \u8F7B\u677E\u641E\u61C25\u79CDIO\u6A21\u578B"),sn={href:"https://toutiao.io/k/eteqw6s",target:"_blank",rel:"noopener noreferrer"},an=s("[\u63A8\u8350] \u4F60\u5206\u5E93\u5206\u8868\u7684\u59FF\u52BF\u5BF9\u4E48\uFF1F\u2014\u2014\u8BE6\u8C08\u6C34\u5E73\u5206\u5E93\u5206\u8868"),pn={href:"https://toutiao.io/k/rdpao5x",target:"_blank",rel:"noopener noreferrer"},tn=s("[\u63A8\u8350] Go \u539F\u751F\u5E76\u53D1\u539F\u8BED\u548C\u6700\u4F73\u5B9E\u8DF5"),on={href:"https://toutiao.io/k/0f5fv4t",target:"_blank",rel:"noopener noreferrer"},en=s("[\u63A8\u8350] \u5982\u4F55\u64B0\u5199\u597D\u7684\u6280\u672F\u65B9\u6848\u8BBE\u8BA1-\u771F\u5B9E\u6848\u4F8B\u5E72\u8D27\u5206\u4EAB"),cn={href:"https://toutiao.io/k/k6tjws1",target:"_blank",rel:"noopener noreferrer"},ln=s("[\u63A8\u8350] \u6211\u505A\u57FA\u7840\u67B6\u6784\u5B66\u5230\u768442\u4EF6\u4E8B"),rn={href:"https://toutiao.io/k/5tx1zgw",target:"_blank",rel:"noopener noreferrer"},un=s("[\u63A8\u8350] \u652F\u4ED8\u7CFB\u7EDF\u67B6\u6784\u8BBE\u8BA1\u8BE6\u89E3"),kn={href:"https://toutiao.io/k/fb7mdkl",target:"_blank",rel:"noopener noreferrer"},bn=s("[\u63A8\u8350] ClickHouse\u4F7F\u7528\u5B9E\u8DF5\u4E0E\u89C4\u8303"),mn={href:"https://toutiao.io/k/pnlaqae",target:"_blank",rel:"noopener noreferrer"},dn=s("[\u63A8\u8350] \u4EC0\u4E48\u4EBA\u80FD\u6210\u4E3ALeader\uFF0C\u5927Leader\u8BE5\u505A\u4EC0\u4E48"),fn={href:"https://toutiao.io/k/6f1qaso",target:"_blank",rel:"noopener noreferrer"},_n=s("[\u63A8\u8350] \u795E\u5668 Nginx \u7684\u5B66\u4E60\u624B\u518C ( \u5EFA\u8BAE\u6536\u85CF )"),hn=n("h2",{id:"code",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#code","aria-hidden":"true"},"#"),s(" code")],-1),gn={href:"https://leetcode-cn.com/problems/the-number-of-good-subsets",target:"_blank",rel:"noopener noreferrer"},yn=s("\u597D\u5B50\u96C6\u7684\u6570\u76EE"),wn=l(`<h2 id="\u6BCF\u65E5\u4E00\u9898" tabindex="-1"><a class="header-anchor" href="#\u6BCF\u65E5\u4E00\u9898" aria-hidden="true">#</a> \u6BCF\u65E5\u4E00\u9898</h2><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>                  \u7F51\u4E0A\u770B\u5230\u6709\u4EBA\u5206\u4EAB\u53BB\u5B57\u8282\u8DF3\u52A8\u7684\u9762\u8BD5 Go \u7684\u7ECF\u9A8C\uFF0C\u4ECE\u9762\u8BD5\u9898\u6765\u770B\uFF0C\u5E94\u8BE5\u662F\u6BD4\u8F83\u521D\u7EA7\u7684\u804C\u4F4D\u3002
\u8FD9\u4EFD\u9762\u8BD5\u7ECF\u9A8C\u603B\u7ED3\u4E2D\uFF08\u5176\u5B9E\u8C08\u4E0D\u4E0A\u603B\u7ED3\uFF0C\u53EA\u662F\u9762\u8BD5\u9898\u7684\u8BB0\u5F55\uFF0C\u5E76\u6CA1\u6709\u603B\u7ED3\u5206\u6790\u7B54\u6848\uFF09\uFF0C\u6709\u4E00\u9053 Go \u76F8\u5173\u7684\u9898\uFF0C\u4E5F\u662F\u4E00\u4E2A\u8001\u751F\u5E38\u8C08\u7684\u95EE\u9898\uFF1A\u4EE5\u4E0B\u4EE3\u7801\u6709\u4EC0\u4E48\u95EE\u9898\uFF0C\u600E\u4E48\u89E3\u51B3\uFF1F
total<span class="token punctuation">,</span> sum <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> i
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        total <span class="token operator">+=</span> i
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;total:%d sum %d&quot;</span><span class="token punctuation">,</span> total<span class="token punctuation">,</span> sum<span class="token punctuation">)</span>


                  
                    \u67E5\u770B\u7B54\u6848
                  
                
                  \u7B54\u6848\u89E3\u6790\uFF1A
                  <span class="token number">01</span> \u8003\u70B9\u4E00
\u6211\u76F8\u4FE1\u5F88\u591A\u4EBA\u5E94\u8BE5\u4E00\u773C\u770B\u51FA\u4E86\u5176\u4E2D\u7684\u4E00\u4E2A\u95EE\u9898\uFF0C\u90A3\u5C31\u662F i \u4F7F\u7528\u7684\u95EE\u9898\u3002\u5E38\u89C1\u7684\u9898\u76EE\u662F\u8FD9\u6837\u7684\uFF1A\u4EE5\u4E0B\u4EE3\u7801\uFF0C\u8F93\u51FA\u4EC0\u4E48\uFF1F
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1e9</span><span class="token punctuation">)</span>

\u76F8\u4FE1\u5F88\u591A\u4EBA\u77E5\u9053\uFF0C\u4F1A\u8F93\u51FA\u4E00\u5806 <span class="token number">11</span>\uFF08\u53EF\u80FD\u8FD8\u6709\u5176\u4ED6\u7684\u6570\u5B57\uFF09\uFF0C\u800C\u4E0D\u662F\u671F\u671B\u7684\u8F93\u51FA <span class="token number">1</span> \u5230 <span class="token number">10</span>\u3002
\u600E\u4E48\u6539\u8FDB\uFF1F\u4F60\u5E94\u8BE5\u4E5F\u77E5\u6653\u3002
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1e9</span><span class="token punctuation">)</span>

\uFF08\u5F53\u7136\u8FD9\u91CC\u7684\u8F93\u51FA\u987A\u5E8F\u662F\u4E71\u7684\uFF0C\u5927\u5BB6\u5E94\u8BE5\u6E05\u695A\uFF09
<span class="token number">02</span> \u8003\u70B9\u4E8C
\u8BE5\u9898\u7684\u7B2C\u4E8C\u4E2A\u8003\u70B9\uFF1Adata race\u3002\u56E0\u4E3A\u5B58\u5728\u591A goroutine \u540C\u65F6\u5199 total \u53D8\u91CF\u7684\u95EE\u9898\uFF0C\u6240\u4EE5\u6709\u6570\u636E\u7ADE\u4E89\u3002\u53EF\u4EE5\u52A0\u4E0A <span class="token operator">-</span>race \u53C2\u6570\u9A8C\u8BC1\uFF1A
$ <span class="token keyword">go</span> run <span class="token operator">-</span>race main<span class="token punctuation">.</span><span class="token keyword">go</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
WARNING<span class="token punctuation">:</span> DATA RACE
Read at <span class="token number">0x00c0001b4020</span> by goroutine <span class="token number">8</span><span class="token punctuation">:</span>
  main<span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">/</span>Users<span class="token operator">/</span>xuxinhua<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">12</span> <span class="token operator">+</span><span class="token number">0x57</span>

Previous write at <span class="token number">0x00c0001b4020</span> by main goroutine<span class="token punctuation">:</span>
  main<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">/</span>Users<span class="token operator">/</span>xuxinhua<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">9</span> <span class="token operator">+</span><span class="token number">0x10b</span>

Goroutine <span class="token number">8</span> <span class="token punctuation">(</span>running<span class="token punctuation">)</span> created at<span class="token punctuation">:</span>
  main<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">/</span>Users<span class="token operator">/</span>xuxinhua<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">11</span> <span class="token operator">+</span><span class="token number">0xe7</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

\u8FD9\u53EF\u4EE5\u901A\u8FC7\u52A0\u9501\u7684\u65B9\u5F0F\u89E3\u51B3\uFF1A
<span class="token keyword">var</span> mutex sync<span class="token punctuation">.</span>Mutex
total<span class="token punctuation">,</span> sum <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
  sum <span class="token operator">+=</span> i
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mutex<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    total <span class="token operator">+=</span> i
    mutex<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

\u6B64\u5916\uFF0C\u4E5F\u53EF\u4EE5\u901A\u8FC7 atomic \u5305\u89E3\u51B3\uFF1A\uFF08\u6CE8\u610F total \u7684\u7C7B\u578B\uFF0C\u56E0\u4E3A atomic<span class="token punctuation">.</span>AddInt64 \u9700\u8981\uFF09
<span class="token keyword">var</span> total <span class="token builtin">int64</span>
sum <span class="token operator">:=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
  sum <span class="token operator">+=</span> i
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    atomic<span class="token punctuation">.</span><span class="token function">AddInt64</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>total<span class="token punctuation">,</span> <span class="token function">int64</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

\u901A\u8FC7 <span class="token operator">-</span>race \u4F60\u9A8C\u8BC1\uFF0C\u53D1\u73B0 data race \u6CA1\u4E86\u3002
\u7EC6\u5FC3\u7684\u4F60\u4E0D\u77E5\u9053\u53D1\u73B0\u6CA1\u6709\uFF0C\u4EE5\u4E0A\u4EE3\u7801\u6211\u6545\u610F\u628A\u6700\u540E\u7684 fmt \u8F93\u51FA\u90A3\u4E00\u884C\u53BB\u6389\u4E86\uFF0C\u56E0\u4E3A\u5B83\u7528\u4E86 total \u53D8\u91CF\uFF0C\u907F\u514D\u5B83\u5BFC\u81F4 data race\u3002\u8FD9\u5F15\u51FA\u8003\u70B9\u4E09\u3002
<span class="token number">03</span> \u8003\u70B9\u4E09
\u6211\u4E0A\u9762\u90FD\u6CA1\u6709\u7ED9\u5B8C\u6574\u7684\u4EE3\u7801\uFF0C\u56E0\u4E3A\u7ECF\u8FC7\u4E0A\u9762\u4E24\u6B65\uFF0C\u6700\u7EC8\u7684\u7ED3\u679C\u8FD8\u662F\u4E0D\u5BF9\u7684\u3002\u4ECE\u4E0A\u9762\u8BF4\u7684 fmt \u8F93\u51FA\u4EE3\u7801\u53BB\u6389\u5C31\u8BF4\u660E\u8FD8\u6709\u95EE\u9898\u3002
\u521D\u5B66 Go \u5E94\u8BE5\u9047\u5230\u7C7B\u4F3C\u8FD9\u6837\u7684\u95EE\u9898\uFF0C\u4E0B\u9762\u4EE3\u7801\u4E00\u822C\u6CA1\u6709\u8F93\u51FA\u3002
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

\u539F\u56E0\u662F main \u51FD\u6570\u5148\u9000\u51FA\u4E86\uFF0C\u5F00\u542F\u7684 goroutine \u6839\u672C\u6CA1\u6709\u673A\u4F1A\u6267\u884C\u3002\u6240\u4EE5\uFF0C\u5E38\u89C1\u7684\u89E3\u51B3\u529E\u6CD5\u662F\u5728\u6700\u540E\u52A0\u4E00\u4E2A Sleep\uFF1A
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  
  time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1e9</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

Sleep \u4F1A\u8BA9 main goroutine \u4F11\u7720\uFF0C\u8C03\u5EA6\u5668\u8C03\u5EA6\u5176\u4ED6 goroutine \u8FD0\u884C\u3002
\u56DE\u5230\u5F00\u5934\u7684\u9898\u76EE\u5176\u5B9E\u4E5F\u5B58\u5728\u8FD9\u4E2A\u95EE\u9898\uFF0C\u901A\u8FC7\u5728 fmt \u8BED\u53E5\u4E4B\u524D\u52A0\u4E0A Sleep\uFF0C\u57FA\u672C\u80FD\u5F97\u5230\u6B63\u786E\u7684\u7ED3\u679C\uFF1A
<span class="token keyword">var</span> total <span class="token builtin">int64</span>
sum <span class="token operator">:=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> i
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        atomic<span class="token punctuation">.</span><span class="token function">AddInt64</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>total<span class="token punctuation">,</span> <span class="token function">int64</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1e9</span><span class="token punctuation">)</span>

fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;total:%d sum %d&quot;</span><span class="token punctuation">,</span> total<span class="token punctuation">,</span> sum<span class="token punctuation">)</span>

\u4F46\u5982\u679C\u52A0\u4E0A <span class="token operator">-</span>race \u53D1\u73B0\u8FD8\u662F\u6709\u95EE\u9898\uFF1A
$ <span class="token keyword">go</span> run <span class="token operator">-</span>race main<span class="token punctuation">.</span><span class="token keyword">go</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
WARNING<span class="token punctuation">:</span> DATA RACE
Read at <span class="token number">0x00c00001c0b0</span> by main goroutine<span class="token punctuation">:</span>
  main<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">/</span>Users<span class="token operator">/</span>xuxinhua<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">20</span> <span class="token operator">+</span><span class="token number">0xe4</span>

Previous write at <span class="token number">0x00c00001c0b0</span> by goroutine <span class="token number">7</span><span class="token punctuation">:</span>
  sync<span class="token operator">/</span>atomic<span class="token punctuation">.</span><span class="token function">AddInt64</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">/</span>Users<span class="token operator">/</span>xuxinhua<span class="token operator">/</span><span class="token punctuation">.</span><span class="token keyword">go</span><span class="token operator">/</span>current<span class="token operator">/</span>src<span class="token operator">/</span>runtime<span class="token operator">/</span>race_amd64<span class="token punctuation">.</span>s<span class="token punctuation">:</span><span class="token number">276</span> <span class="token operator">+</span><span class="token number">0xb</span>
  main<span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">/</span>Users<span class="token operator">/</span>xuxinhua<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">15</span> <span class="token operator">+</span><span class="token number">0x44</span>

Goroutine <span class="token number">7</span> <span class="token punctuation">(</span>finished<span class="token punctuation">)</span> created at<span class="token punctuation">:</span>
  main<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">/</span>Users<span class="token operator">/</span>xuxinhua<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">14</span> <span class="token operator">+</span><span class="token number">0xa4</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
total<span class="token punctuation">:</span><span class="token number">55</span> sum 55Found <span class="token number">1</span> data <span class="token function">race</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>

\u6240\u4EE5\uFF0C\u8FD9\u79CD\u65B9\u5F0F\u662F\u4E0D\u9760\u8C31\u7684\uFF0C\u8FD9\u65F6\u6B63\u786E\u7684\u65B9\u5F0F\u662F\u4F7F\u7528 sync<span class="token punctuation">.</span>WaitGroup\u3002
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;sync/atomic&quot;</span>
    <span class="token string">&quot;sync&quot;</span>
    <span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup
    <span class="token keyword">var</span> total <span class="token builtin">int64</span>
    sum <span class="token operator">:=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        sum <span class="token operator">+=</span> i
        <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            atomic<span class="token punctuation">.</span><span class="token function">AddInt64</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>total<span class="token punctuation">,</span> <span class="token function">int64</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;total:%d sum %d&quot;</span><span class="token punctuation">,</span> total<span class="token punctuation">,</span> sum<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token number">04</span> \u603B\u7ED3
\u901A\u8FC7\u4E0A\u9762\u7684\u5206\u6790\uFF0C\u53D1\u73B0\u770B\u8D77\u6765\u662F\u4E00\u4E2A\u7B80\u5355\u7684\u9898\u76EE\uFF0C\u5176\u5B9E\u8003\u70B9\u597D\u51E0\u4E2A\u3002\u8FD9\u4E2A\u9898\u76EE\u8FD8\u662F\u633A\u597D\u7684\uFF0C\u5B57\u8282\u8DF3\u52A8\u9762\u8BD5\u5B98\u51FA\u7684\u8FD9\u9053\u9898\u8FD8\u662F\u6709\u70B9\u6C34\u5E73\u3002\u4F60\u89C9\u5F97\u5462\uFF1F
\u7B54\u6848\u89E3\u6790\u6765\u81EA\uFF1A<span class="token operator">&lt;</span>## <span class="token number">01</span> \u8003\u70B9\u4E00
\u6211\u76F8\u4FE1\u5F88\u591A\u4EBA\u5E94\u8BE5\u4E00\u773C\u770B\u51FA\u4E86\u5176\u4E2D\u7684\u4E00\u4E2A\u95EE\u9898\uFF0C\u90A3\u5C31\u662F i \u4F7F\u7528\u7684\u95EE\u9898\u3002\u5E38\u89C1\u7684\u9898\u76EE\u662F\u8FD9\u6837\u7684\uFF1A\u4EE5\u4E0B\u4EE3\u7801\uFF0C\u8F93\u51FA\u4EC0\u4E48\uFF1F
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1e9</span><span class="token punctuation">)</span>

\u76F8\u4FE1\u5F88\u591A\u4EBA\u77E5\u9053\uFF0C\u4F1A\u8F93\u51FA\u4E00\u5806 <span class="token number">11</span>\uFF08\u53EF\u80FD\u8FD8\u6709\u5176\u4ED6\u7684\u6570\u5B57\uFF09\uFF0C\u800C\u4E0D\u662F\u671F\u671B\u7684\u8F93\u51FA <span class="token number">1</span> \u5230 <span class="token number">10</span>\u3002
\u600E\u4E48\u6539\u8FDB\uFF1F\u4F60\u5E94\u8BE5\u4E5F\u77E5\u6653\u3002
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1e9</span><span class="token punctuation">)</span>

\uFF08\u5F53\u7136\u8FD9\u91CC\u7684\u8F93\u51FA\u987A\u5E8F\u662F\u4E71\u7684\uFF0C\u5927\u5BB6\u5E94\u8BE5\u6E05\u695A\uFF09
<span class="token number">02</span> \u8003\u70B9\u4E8C
\u8BE5\u9898\u7684\u7B2C\u4E8C\u4E2A\u8003\u70B9\uFF1Adata race\u3002\u56E0\u4E3A\u5B58\u5728\u591A goroutine \u540C\u65F6\u5199 total \u53D8\u91CF\u7684\u95EE\u9898\uFF0C\u6240\u4EE5\u6709\u6570\u636E\u7ADE\u4E89\u3002\u53EF\u4EE5\u52A0\u4E0A <span class="token operator">-</span>race \u53C2\u6570\u9A8C\u8BC1\uFF1A
$ <span class="token keyword">go</span> run <span class="token operator">-</span>race main<span class="token punctuation">.</span><span class="token keyword">go</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
WARNING<span class="token punctuation">:</span> DATA RACE
Read at <span class="token number">0x00c0001b4020</span> by goroutine <span class="token number">8</span><span class="token punctuation">:</span>
  main<span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">/</span>Users<span class="token operator">/</span>xuxinhua<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">12</span> <span class="token operator">+</span><span class="token number">0x57</span>

Previous write at <span class="token number">0x00c0001b4020</span> by main goroutine<span class="token punctuation">:</span>
  main<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">/</span>Users<span class="token operator">/</span>xuxinhua<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">9</span> <span class="token operator">+</span><span class="token number">0x10b</span>

Goroutine <span class="token number">8</span> <span class="token punctuation">(</span>running<span class="token punctuation">)</span> created at<span class="token punctuation">:</span>
  main<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">/</span>Users<span class="token operator">/</span>xuxinhua<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">11</span> <span class="token operator">+</span><span class="token number">0xe7</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

\u8FD9\u53EF\u4EE5\u901A\u8FC7\u52A0\u9501\u7684\u65B9\u5F0F\u89E3\u51B3\uFF1A
<span class="token keyword">var</span> mutex sync<span class="token punctuation">.</span>Mutex
total<span class="token punctuation">,</span> sum <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
  sum <span class="token operator">+=</span> i
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mutex<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    total <span class="token operator">+=</span> i
    mutex<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

\u6B64\u5916\uFF0C\u4E5F\u53EF\u4EE5\u901A\u8FC7 atomic \u5305\u89E3\u51B3\uFF1A\uFF08\u6CE8\u610F total \u7684\u7C7B\u578B\uFF0C\u56E0\u4E3A atomic<span class="token punctuation">.</span>AddInt64 \u9700\u8981\uFF09
<span class="token keyword">var</span> total <span class="token builtin">int64</span>
sum <span class="token operator">:=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
  sum <span class="token operator">+=</span> i
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    atomic<span class="token punctuation">.</span><span class="token function">AddInt64</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>total<span class="token punctuation">,</span> <span class="token function">int64</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

\u901A\u8FC7 <span class="token operator">-</span>race \u4F60\u9A8C\u8BC1\uFF0C\u53D1\u73B0 data race \u6CA1\u4E86\u3002
\u7EC6\u5FC3\u7684\u4F60\u4E0D\u77E5\u9053\u53D1\u73B0\u6CA1\u6709\uFF0C\u4EE5\u4E0A\u4EE3\u7801\u6211\u6545\u610F\u628A\u6700\u540E\u7684 fmt \u8F93\u51FA\u90A3\u4E00\u884C\u53BB\u6389\u4E86\uFF0C\u56E0\u4E3A\u5B83\u7528\u4E86 total \u53D8\u91CF\uFF0C\u907F\u514D\u5B83\u5BFC\u81F4 data race\u3002\u8FD9\u5F15\u51FA\u8003\u70B9\u4E09\u3002
<span class="token number">03</span> \u8003\u70B9\u4E09
\u6211\u4E0A\u9762\u90FD\u6CA1\u6709\u7ED9\u5B8C\u6574\u7684\u4EE3\u7801\uFF0C\u56E0\u4E3A\u7ECF\u8FC7\u4E0A\u9762\u4E24\u6B65\uFF0C\u6700\u7EC8\u7684\u7ED3\u679C\u8FD8\u662F\u4E0D\u5BF9\u7684\u3002\u4ECE\u4E0A\u9762\u8BF4\u7684 fmt \u8F93\u51FA\u4EE3\u7801\u53BB\u6389\u5C31\u8BF4\u660E\u8FD8\u6709\u95EE\u9898\u3002
\u521D\u5B66 Go \u5E94\u8BE5\u9047\u5230\u7C7B\u4F3C\u8FD9\u6837\u7684\u95EE\u9898\uFF0C\u4E0B\u9762\u4EE3\u7801\u4E00\u822C\u6CA1\u6709\u8F93\u51FA\u3002
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

\u539F\u56E0\u662F main \u51FD\u6570\u5148\u9000\u51FA\u4E86\uFF0C\u5F00\u542F\u7684 goroutine \u6839\u672C\u6CA1\u6709\u673A\u4F1A\u6267\u884C\u3002\u6240\u4EE5\uFF0C\u5E38\u89C1\u7684\u89E3\u51B3\u529E\u6CD5\u662F\u5728\u6700\u540E\u52A0\u4E00\u4E2A Sleep\uFF1A
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  
  time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1e9</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

Sleep \u4F1A\u8BA9 main goroutine \u4F11\u7720\uFF0C\u8C03\u5EA6\u5668\u8C03\u5EA6\u5176\u4ED6 goroutine \u8FD0\u884C\u3002
\u56DE\u5230\u5F00\u5934\u7684\u9898\u76EE\u5176\u5B9E\u4E5F\u5B58\u5728\u8FD9\u4E2A\u95EE\u9898\uFF0C\u901A\u8FC7\u5728 fmt \u8BED\u53E5\u4E4B\u524D\u52A0\u4E0A Sleep\uFF0C\u57FA\u672C\u80FD\u5F97\u5230\u6B63\u786E\u7684\u7ED3\u679C\uFF1A
<span class="token keyword">var</span> total <span class="token builtin">int64</span>
sum <span class="token operator">:=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> i
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        atomic<span class="token punctuation">.</span><span class="token function">AddInt64</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>total<span class="token punctuation">,</span> <span class="token function">int64</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1e9</span><span class="token punctuation">)</span>

fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;total:%d sum %d&quot;</span><span class="token punctuation">,</span> total<span class="token punctuation">,</span> sum<span class="token punctuation">)</span>

\u4F46\u5982\u679C\u52A0\u4E0A <span class="token operator">-</span>race \u53D1\u73B0\u8FD8\u662F\u6709\u95EE\u9898\uFF1A
$ <span class="token keyword">go</span> run <span class="token operator">-</span>race main<span class="token punctuation">.</span><span class="token keyword">go</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
WARNING<span class="token punctuation">:</span> DATA RACE
Read at <span class="token number">0x00c00001c0b0</span> by main goroutine<span class="token punctuation">:</span>
  main<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">/</span>Users<span class="token operator">/</span>xuxinhua<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">20</span> <span class="token operator">+</span><span class="token number">0xe4</span>

Previous write at <span class="token number">0x00c00001c0b0</span> by goroutine <span class="token number">7</span><span class="token punctuation">:</span>
  sync<span class="token operator">/</span>atomic<span class="token punctuation">.</span><span class="token function">AddInt64</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">/</span>Users<span class="token operator">/</span>xuxinhua<span class="token operator">/</span><span class="token punctuation">.</span><span class="token keyword">go</span><span class="token operator">/</span>current<span class="token operator">/</span>src<span class="token operator">/</span>runtime<span class="token operator">/</span>race_amd64<span class="token punctuation">.</span>s<span class="token punctuation">:</span><span class="token number">276</span> <span class="token operator">+</span><span class="token number">0xb</span>
  main<span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">/</span>Users<span class="token operator">/</span>xuxinhua<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">15</span> <span class="token operator">+</span><span class="token number">0x44</span>

Goroutine <span class="token number">7</span> <span class="token punctuation">(</span>finished<span class="token punctuation">)</span> created at<span class="token punctuation">:</span>
  main<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">/</span>Users<span class="token operator">/</span>xuxinhua<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">14</span> <span class="token operator">+</span><span class="token number">0xa4</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
total<span class="token punctuation">:</span><span class="token number">55</span> sum 55Found <span class="token number">1</span> data <span class="token function">race</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>

\u6240\u4EE5\uFF0C\u8FD9\u79CD\u65B9\u5F0F\u662F\u4E0D\u9760\u8C31\u7684\uFF0C\u8FD9\u65F6\u6B63\u786E\u7684\u65B9\u5F0F\u662F\u4F7F\u7528 sync<span class="token punctuation">.</span>WaitGroup\u3002
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;sync/atomic&quot;</span>
    <span class="token string">&quot;sync&quot;</span>
    <span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup
    <span class="token keyword">var</span> total <span class="token builtin">int64</span>
    sum <span class="token operator">:=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        sum <span class="token operator">+=</span> i
        <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            atomic<span class="token punctuation">.</span><span class="token function">AddInt64</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>total<span class="token punctuation">,</span> <span class="token function">int64</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;total:%d sum %d&quot;</span><span class="token punctuation">,</span> total<span class="token punctuation">,</span> sum<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token number">04</span> \u603B\u7ED3
\u901A\u8FC7\u4E0A\u9762\u7684\u5206\u6790\uFF0C\u53D1\u73B0\u770B\u8D77\u6765\u662F\u4E00\u4E2A\u7B80\u5355\u7684\u9898\u76EE\uFF0C\u5176\u5B9E\u8003\u70B9\u597D\u51E0\u4E2A\u3002\u8FD9\u4E2A\u9898\u76EE\u8FD8\u662F\u633A\u597D\u7684\uFF0C\u5B57\u8282\u8DF3\u52A8\u9762\u8BD5\u5B98\u51FA\u7684\u8FD9\u9053\u9898\u8FD8\u662F\u6709\u70B9\u6C34\u5E73\u3002\u4F60\u89C9\u5F97\u5462\uFF1F
\u7B54\u6848\u89E3\u6790\u6765\u81EA\uFF1Ahttps<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>polarisxu<span class="token punctuation">.</span>studygolang<span class="token punctuation">.</span>com<span class="token operator">/</span>posts<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>action<span class="token operator">/</span>bytedance<span class="token operator">-</span>interview<span class="token operator">-</span><span class="token number">201112</span><span class="token operator">/</span>

                
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br></div></div>`,2);function xn(qn,An){const a=t("ExternalLinkIcon");return o(),e(c,null,[i,k,n("p",null,[n("a",b,[m,p(a)])]),n("p",null,[n("a",d,[f,p(a)])]),n("p",null,[n("a",_,[h,p(a)])]),n("p",null,[n("a",g,[y,p(a)])]),n("p",null,[n("a",w,[x,p(a)])]),n("p",null,[n("a",q,[A,p(a)])]),n("p",null,[n("a",v,[P,p(a)])]),n("p",null,[n("a",G,[I,p(a)])]),n("p",null,[n("a",S,[U,p(a)])]),n("p",null,[n("a",W,[R,p(a)])]),n("p",null,[n("a",N,[C,p(a)])]),n("p",null,[n("a",E,[T,p(a)])]),n("p",null,[n("a",H,[L,p(a)])]),n("p",null,[n("a",V,[D,p(a)])]),n("p",null,[n("a",F,[j,p(a)])]),n("p",null,[n("a",M,[$,p(a)])]),n("p",null,[n("a",z,[B,p(a)])]),n("p",null,[n("a",K,[J,p(a)])]),n("p",null,[n("a",O,[Q,p(a)])]),n("p",null,[n("a",X,[Y,p(a)])]),n("p",null,[n("a",Z,[nn,p(a)])]),n("p",null,[n("a",sn,[an,p(a)])]),n("p",null,[n("a",pn,[tn,p(a)])]),n("p",null,[n("a",on,[en,p(a)])]),n("p",null,[n("a",cn,[ln,p(a)])]),n("p",null,[n("a",rn,[un,p(a)])]),n("p",null,[n("a",kn,[bn,p(a)])]),n("p",null,[n("a",mn,[dn,p(a)])]),n("p",null,[n("a",fn,[_n,p(a)])]),hn,n("p",null,[n("a",gn,[yn,p(a)])]),wn],64)}var Gn=r(u,[["render",xn]]);export{Gn as default};
